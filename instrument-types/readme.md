# Instrument Type
Some info on the instrument type entity.



## The JSON
1. **id** - An id generated by npm module bson-objectid
2. **entity** - What this json is applied to
3. **name** - A human readable name
4. **brand** - Just for completeness
5. **model** - Just for completeness
6. **keyboard** (optional) - If isset and not empty, the keyboard will be as big as there are keys in the object. The values are shown on the corresponding (piano)key.
7. **cc** (optional) - An array containing controller code objects (See below)
8. **nrpn** (optional) - An array containing NRPN config objects (See below)

**Example:**
```
{
  "id": "56f95572c5af6215adfdbc45",
  "entity": "instrument-type",
  "name": "Electribe",
  "brand": "Korg",
  "model": "ER-1mkII",
  
 // Only the listed (piano)keys will be displayed in the pattern view and they will 
 // be labeled by their corresponding values
  "keyboard":{
      "C2":"S1",    // Synth 1 
      "D2":"S2",    // Synth 2
      "E2":"S3",    // Synth 3
      "F2":"S4",    // Synth 4
      "G2":"A1",    // Audio 1
      "A2":"A2",    // Audio 1
      "B2":"HH CL", // Hi-Hat Close
      "C3":"HH OP", // Hi-Hat Open
      "D3":"CR",    // Crash
      "E3":"CL"     // Clap
    },
    "cc":{/* See below */},
    "nrpn":{/* See below */}
}
```
### Controller Code (CC)
A controller message consists of 3 bytes.

1. channel selection
2. controller selection
3. value

Channel selection is done by selecting a value between `0xB0` - `0xBF`. Numerical this is `175 + channelNr`. So for channel 1 it is `176` which corresponds to `0xB0`. The channel is selected on the instrument (not the instrument type) so this value will be read from there. For this reason you don't have to configure it in the `cc` object in the json.

Controller selection is done by choosing a controller from `0x00` - `0x&F` or `0` - `127`. See [this doc](http://www.indiana.edu/~emusic/cntrlnumb.html) for a description of each controller.

Finally choose a value for this controller, which is a number between `0` and `127`.


**Example:**

The following bytes represent a halfway turned modulation wheel message to midi channel 9
```
0xB8 0x01 0x40
```
**For example for the XL-1 knob A**
```
{
	"name":"XL-1",
	...
	"cc":[
		{
    		"name":"A",
    		"cc":"0x15" // 21
    	},
    	{
			"name":"B",
			"cc":"0x0E" // 14
		},
    	...
    	{
    		"name":"L",
			"cc":"0x5D" // 93
    	}
	]
}
```
### Non-Registered Parameter Number (NRPN)
An nrpn message is constructed of 4 midi controller messages.

1. cc 99 (`0x63`) NRPN MSB
2. cc 98 (`0x62`) NRPN LSB
3. cc 6 (`0x06`) Data entry MSB
4. cc 38 (`0x26`) Data entry LSB


1. **name** - Human readable param name
2. **keyboard** (optional) - The Param should only be displayed if this key is selected on the piano. If keyboard is omitted or if it has value `"*"`, it will always be shown. 
3. **nm** - Short for **N**RPN **M**SB
5. **nl** - Short for **N**RPN **L**SB
4. **dm** (optional) - Short for **D**ata entry **M**SB
4. **dl** (optional) - Short for **D**ata entry **L**SB, for more precicion

The values `dm` and `dl` both represent the value for this parameter. That is why it is more precise `0-16384` in stead
of `0-127`.

In the case of my Electribe, the `dl` is set to a specific value. But it could also be variable for another midi device. In the application you will be able to send both `dm` and `dl`. If `dl` is omitted it will use the value in the config.
   
Some params are nominal, like in the Electribe the param delay type. It can be `Off`, `Motion Seq` or `Tempo Delay`. If `dm` is an object the application will use this info to decide what GUI objet to use for the step. So in the case of Delay type, in each step of the step sequencer you'll be able to select either of the options through radio buttons in stead of a slider. Some params also might have a different range. from 0-100 for example (Electribe Input Gain). So to sum up, `dm` can be  configured to be:

1. For a nominal value - `{"Off":0, "Motion Seq":1, "Tempo Delay":2}`
2. For a range - `{"from":0, "to":100}` 

**Example**
```
{
	"id": "56f95572c5af6215adfdbc45",
	"entity": "instrument-type",
	"name": "Electribe",
	"brand": "Korg",
	"model": "ER-1mkII",
	"keyboard":{
		"C2":"S1",
		"D2":"S2",
		"E2":"S3",
		"F2":"S4",
		"G2":"A1",
		"A2":"A2",
		"B2":"HH CL",
		"C3":"HH OP",
		"D3":"CR",
		"E3":"CL"
	},
	"nrpn": [
		{
			"name": "Low Boost",
			"keyboard": "S1",
			"nm": "0x02",
			"nl": "0x00",
			"dl": "0x01"
		},
		{
			"name": "Input Gain",
			"keyboard": "A1",
			"nm": "0x02",
			"nl": "0x68",
			"dm":{"from":0, "to":100},
			"dl": "0x68"
		},
		{
			"name": "Delay Type",
			"keyboard": "*",
			"nm": "0x02",
			"nl": "0x6B",
			"dm":{"Off":0, "Motion Seq":1, "Tempo Delay":2},
			"dl": "0x6B"
		},
		...
	]
	...
}
```

## See also
1. [NRPN on Wikipedia](https://en.wikipedia.org/wiki/NRPN)
2. [List of Controller numbers](http://www.indiana.edu/~emusic/cntrlnumb.html)